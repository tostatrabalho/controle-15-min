<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Supervisor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Configurações</h1>
    <label>
      <input type="checkbox" id="permitir" />
      Permitir pausas simultâneas (Web + Fone)
    </label><br>
    <label>
      Tempo mínimo restante para liberar outro: 
      <input type="number" id="tempoMin" min="0" /> minutos
    </label><br>
    <button onclick="salvar()">Salvar</button>

    <h2>Colaboradores em pausa</h2>
    <ul id="lista"></ul>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

    const supabase = createClient(
      'https://ochhmishdtxwprhnlenj.supabase.co',
      'SUA_ANON_KEY_AQUI'
    );

    const permitir = document.getElementById("permitir");
    const tempoMin = document.getElementById("tempoMin");
    const lista = document.getElementById("lista");

    async function carregarConfiguracoes() {
      const { data } = await supabase.from("configuracoes").select("*").single();
      if (data) {
        permitir.checked = data.permitir_pausas_simultaneas;
        tempoMin.value = data.tempo_minimo_entre_pausas;
      }
    }

    async function salvar() {
      await supabase.from("configuracoes").upsert({
        id: 1,
        permitir_pausas_simultaneas: permitir.checked,
        tempo_minimo_entre_pausas: parseInt(tempoMin.value || "0")
      });
      alert("Configurações salvas!");
    }

    async function listarPausas() {
      const { data } = await supabase.from("pausas").select("inicio, usuarios(nome)").is("fim", null).order("inicio");
      lista.innerHTML = "";
      data.forEach(p => {
        const inicio = new Date(p.inicio);
        const volta = new Date(inicio.getTime() + 15 * 60000);
        const li = document.createElement("li");
        li.textContent = `${p.usuarios.nome} - Volta às ${volta.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
        lista.appendChild(li);
      });
    }

    carregarConfiguracoes();
    listarPausas();
  </script>
</body>
</html>